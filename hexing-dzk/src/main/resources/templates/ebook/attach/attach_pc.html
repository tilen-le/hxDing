<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <th:block th:include="include :: header(${title})"/>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="wpk-bid" content="dta_1_1196893985">
    <script type="text/javascript" src="https://g.alicdn.com/dingding/dingtalk-jsapi/2.10.3/dingtalk.open.js"></script>
    <script>
        !(function (c, i, e, b) {
            var h = i.createElement("script");
            var f = i.getElementsByTagName("script")[0];
            h.type = "text/javascript";
            h.crossorigin = true;
            h.onload = function () {
                c[b] || (c[b] = new c.wpkReporter({bid: "dta_1_1196893985"}));
                c[b].installAll()
            };
            f.parentNode.insertBefore(h, f);
            h.src = e
        })(window, document, "https://g.alicdn.com/woodpeckerx/jssdk??wpkReporter.js", "__wpk");</script>
    <link th:href="@{/dzk/demo.css}" rel="stylesheet" media="all"/>
    <link th:href="@{/dzk/basic.css}" rel="stylesheet" media="min-width: 800px"/>
    <link th:href="@{/dzk/notification.css}" rel="stylesheet" media="all"/>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <!--[if IE]>
    <![endif]-->
    <style type="text/css">
        .imgContain {
            width: 840px;
            pointer-events:none;
        }

        .user-forum-thumbs {
            width: 100%;
            height: 10vh;
            line-height: 10vh;
        }
        .commentBotton {
            width: 840px;
            height: 8vh;
            line-height: 8vh;
            background: #ece9e9;
            float: left;
            text-align: left;
            font-family: '宋体';
            border-color: #dddddd;
            border-radius:5px;
        }

        .user-content-solid {
            width: 840px;
            border-bottom: 2px solid #cdcecf;
            margin-inside: 5px;
        }
        .goodComment {
            width: 840px;
            height: 30px;
            line-height: 30px;
            background: #efeff1;
            text-align: left;
            font-family: Helvetica;
            color: #696c6e;
        }
        .user-remarks-content {
            width: 840px;
            height: 25px;
            line-height: 25px;
            background: #efeff1;
        }

        .user-remarks-content>p {
            font-size: 18px;
            font-family: "宋体";
        }

        .user-remarks-content>p>span {
            color: #686a6b;
        }

        .user-remarks-content>p>span>span {
            color: black;
        }

        .user-remarks-content>button {
            width: 16%;
            border: 0;
            height: 3vh;
            background-color: #ffffff;
            color: #0e90d2;
            cursor: pointer;
        }

        .user-remarks-content>button>span {
            float: left;
            margin-top: 0.2vh;
            font-size: 12px;
        }

        .Input_Box {
            width: 840px;
            height: 105px;
        }
        .Input_Box>textarea {
            width: 840px;
            height: 70px;
            padding: 5px;
            outline: none;
            border: 0px solid #fff;
            resize: none;
            font: 13px “微软雅黑”, Arial, Helvetica, sans-serif;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
        }
        .Input_Foot {
            width: 840px;
            height: 35px;
            border-top: 1px solid #ccc;
            background-color: #fff;
            -moz-border-radius: 0 0 5px 5px;
            -webkit-border-radius: 0 0 5px 5px;
            border-radius: 0 0 5px 5px;
            position: absolute;
        }
        .postBtn {
            float: right;
            font: 13px “微软雅黑”, Arial, Helvetica, sans-serif;
            color: #808080;
            padding: 9px 20px 7px 20px;
            border-left: 1px solid #ccc;
            cursor: pointer;
            -moz-border-radius: 0 0 5px 0;
            -webkit-border-radius: 0 0 5px 0;
            border-radius: 0 0 5px 0;
            background-color: #e4e9ec;
        }
        .postBtn:hover {
            color: #333;
            background-color: #f33232;
        }
        .postBtn:active {
            padding: 10px 20px 6px 20px;
        }
        .fa fa-thumbs-o-up {
            width: 20px;
            height: 20px;
        }
    </style>

    <script type="text/javascript" th:src="@{/dzk/jquery.min.1.7.js}"></script>
    <script type="text/javascript" th:src="@{/dzk/turn.js}"></script>
    <script type="text/javascript" th:src="@{/dzk/jquery.qrcode.min.js}"></script>
    <script type="text/javascript" th:src="@{/dzk/modernizr.2.5.3.min.js}"></script>
    <script th:src="@{/js/imagesloaded.pkgd.min.js}"></script>
</head>
<body class="gray-bg">

<div id="dataDiv" class="wrapper wrapper-content animated fadeInRight" style="display: flex;background-color: #89898905;display: none;">
    <div style="display: flex;width: 1000px;margin: auto;margin-top: 5px;">
        <div style="width: 840px;margin: auto;">
            <img class="imgContain" th:src="@{${attach.attachUrl}}">
            <div class="user-forum-thumbs">
                <div style="width: 840px;height: 3vh;margin-top: 2vh">
                    <a href="#thumbs-o-up" id="up" onclick="thumbUpClock()" style="height: 3vh;float: right;margin-right: 4vh;line-height: 3vh"><i class="fa fa-thumbs-o-up"></i></a>
                    <a href="#thumbs-up" id="down" onclick="thumbUpClock()" style="height: 3vh;float: right;margin-right: 4vh;line-height: 3vh"><i class="fa fa-thumbs-up"></i></a>
                </div>
                <div style="width: 840px;height: 5vh;margin-right: 2vh">
                    <span id="num" th:text="${num}" style="height: 4vh;float: right ;line-height: 4vh;margin-right: 4vh"></span>
                </div>
            </div>
            <div class="user-content-solid"></div>

            <div style="width: 840px;height: 8vh" id="openspeekShow"><button id="openspeek" class="commentBotton">写下你的留言</button></div>
            <div class="Input_Box" id="input" style="display: none">
                <textarea class="Input_text" id="inputText" placeholder="描述不能超过200个字！"
                          maxlength="200" οnchange="this.value=this.value.substring(0, 200)"
                          οnkeydοwn="this.value=this.value.substring(0, 200)"
                          οnkeyup="this.value=this.value.substring(0, 200)">
                </textarea>
                <div class="Input_Foot"> <a class="imgBtn" href="javascript:void(0);"></a><a class="postBtn" onclick="addDiv()">确定</a> </div>
            </div>

            <div style="margin-top: 10px">
                <div class="goodComment">精选留言</div>
                <div class="user-remarks-addcontent" id="addcontent"></div>
            </div>

        </div>
    </div>
</div>

    <th:block th:include="include :: footer"/>

    <script type="text/javascript" th:inline="javascript">

    </script>
    <script type="text/javascript" th:inline="javascript">
        $(function() {
            // if (dd.env.platform=="notInDingTalk") {
            //     alert("请用钉钉打开！");
            //     return;
            // } else {
                $('#dataDiv').show();
                var attach = [[${attach}]];
                if (attach == null || attach.attachUrl == null) {
                    $.modal.msgError("本期刊没有上传内容");
                }
            // }
                var show = [[${praiseMark}]];
                if (!show){
                    document.getElementById("up").style.display = "block";
                    document.getElementById("down").style.display = "none";
                    // $('.content').toggleClass('heart-active')
                }else {
                    document.getElementById("up").style.display = "none";
                    document.getElementById("down").style.display = "block";
                }
                getAllComment()
                function getAllComment(){
                    $.ajax({
                        type: "Get",
                        cache: false,
                        url: "/dzk/ebook/attach/getAllComment",
                        dataType: "json",
                        success: function (result) {
                            if (result.code==0){
                                console.log(result.msg)
                                var commentList = result.data
                                drowComment(commentList)
                            }else {
                                console.log(result.msg)
                            }
                        },
                        error: function (result) {
                            console.log(result.msg)
                        }
                    });
                }

        })
        /**
         * 点赞数
         * @type {number}
         */
        var flag = [[${praiseMark}]]
        function thumbUpClock() {
            var n = document.getElementById("num");
            // 根据类切换类名
            if (flag) {
                n.innerHTML = parseInt(n.innerHTML) + 1;
                document.getElementById("up").style.display = "block";
                document.getElementById("down").style.display = "none";
                flag = false;
                thumbsUp(flag)
            } else {
                n.innerHTML = parseInt(n.innerHTML) - 1;
                document.getElementById("up").style.display = "none";
                document.getElementById("down").style.display = "block";
                flag = true;
                thumbsUp(flag)
            }
        };
        function thumbsUp(flag) {
            $.ajax({
                type: "Get",
                cache: false,
                url: "/dzk/ebook/attach/thumbsUp",
                data: {"flag":flag},
                dataType: "json",
                success: function (result) {
                    if (result.code==0){
                        console.log(result.msg)
                    }else {
                        console.log(result.msg)
                    }
                },
                error: function (result) {
                    console.log(result.msg)
                }
            });
        }

        /**
         * 评论
         */
        $(document).ready(function() {
            $("#openspeek").click(function() {
                document.getElementById("input").style.display = "block";
                document.getElementById("openspeekShow").style.display = "none";
            });
        });

        function addDiv() {
            var commentList = []
            var txt4 = document.getElementById('inputText').value;
            if (txt4 == '' || txt4 == ' ') {
                alert('请输入评论内容！');
                document.getElementById("input").style.display = "none";
                document.getElementById("openspeekShow").style.display = "block";
            }else {
                $.ajax({
                    type: "Post",
                    cache: false,
                    url: "/dzk/ebook/attach/addComment",
                    data: {"comment":txt4},
                    dataType: "json",
                    success: function (result) {
                        if (result.code==0){
                            console.log(result.msg)
                            commentList = result.data
                            drowComment(commentList)
                        }else {
                            console.log(result.msg)
                        }
                    },
                    error: function (result) {
                        console.log(result.msg)
                    }
                });
            }
        };
        function drowComment(commentList){
            document.getElementById("addcontent").innerHTML =null;
            for (let list of commentList){
                // 添加节点嵌套
                var node = document.createElement('div');
                var a=document.createElement("a");
                var btn1 = document.createElement('button');
                var txt1 = document.createElement("p");
                var txt2 = document.createElement("span");
                var txt3 = document.createElement("span");
                node.className = 'user-remarks-content';
                // 插入内容
                txt2.innerHTML = list.userName+":";
                txt3.innerHTML = list.comment;
                a.innerHTML=' <a href="#user" ><i class="fa fa-user"></i></a>';
                txt1.appendChild(btn1);
                btn1.appendChild(a);
                txt1.appendChild(txt2);
                txt2.appendChild(txt3);
                node.appendChild(txt1);
                document.getElementById("addcontent").appendChild(node);
            }
            document.getElementById("input").style.display = "none";
            document.getElementById("openspeekShow").style.display = "block";
            $('#inputText').val('');
        }
    </script>
    </body>
</html>
